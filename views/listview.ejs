<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <style>
      table { border-collapse: collapse; width: 100%; }
      th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
      th { background: #f0f0f0; }
      .pager { margin: 8px 0; }
    </style>
  </head>
  <body>
    <h1><%= title %></h1>
    <div class="pager">
      <a href="/list?year=<%= prev.year %>&month=<%= prev.month %>">前の月</a>
      &nbsp;|&nbsp;
      <a href="/list?year=<%= next.year %>&month=<%= next.month %>">次の月</a>
    </div>
    <style>
      .table-container { max-height: 72vh; overflow: auto; }
      thead tr:first-child th { position: sticky; top: 0; z-index: 3; }
      thead tr:nth-child(2) th { position: sticky; top: 38px; z-index: 2; }
      thead th { background: #f0f0f0; }
    </style>

    <div class="table-container">
    <table>
      <thead>
        <tr>
          <th rowspan="2">日付</th>
          <% if (es && es.es) { %>
            <% es.es.forEach(function(item){ %>
              <th colspan="2"><%= item.contents[1] %></th>
            <% }); %>
          <% } %>
        </tr>
        <tr>
          <% if (es && es.es) { %>
            <% es.es.forEach(function(item){ %>
              <th>測定量</th>
              <th>計算値</th>
            <% }); %>
          <% } %>
        </tr>
      </thead>
      <tbody>
        <% function fmt(v){ if (v===null || typeof v === 'undefined' || v === '') return ''; var n = Number(v); return (isFinite(n))? n.toFixed(3) : v; } %>
        <% if (!rows || rows.length === 0) { %>
          <tr><td colspan="<%= (es && es.es) ? (1 + es.es.length*2) : 1 %>">該当データはありません。</td></tr>
        <% } else { %>
          <% rows.forEach(function(r){ %>
            <tr>
              <td><%= r.date ? (typeof r.date === 'string' ? r.date.slice(0,10) : r.date.toISOString().slice(0,10)) : '' %></td>
              <% if (es && es.es) { %>
                <% es.es.forEach(function(item){ %>
                  <% var x = item.contents[2]; %>
                  <% var y = item.contents[3]; %>
                  <td><%= fmt(r[x]) %></td>
                  <td><%= fmt(r[y]) %></td>
                <% }); %>
              <% } %>
            </tr>
          <% }); %>
        <% } %>
      </tbody>
    </table>
    </div>

    <div class="pager">
      <a href="/list?year=<%= prev.year %>&month=<%= prev.month %>">◀ 前の月</a>
      &nbsp;|&nbsp;
      <a href="/list?year=<%= next.year %>&month=<%= next.month %>">次の月 ▶</a>
    </div>
  </body>
</html>
